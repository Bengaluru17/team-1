<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dimple/2.3.0/dimple.latest.min.js"></script>
  <style>
  circle.dimple-series-1 {
  fill:red;
  }
  h2{
  text-align: center;
  }

  </style>
</head>
<body>
    <!-- Create an element for our chart -->
  <h2>Activity Report</h2>
<div id="chart" style="height: 400px; width: 100%;"></div>

<script type="text/javascript">
var data=[];

  //data organization
     var trainings = {
       "tailoring":0,
       "dataentry":0,
       "embroidery":0,
       "candlemaking":0
     };
     var number_trained = {
       "tailoring":0,
       "dataentry":0,
       "embroidery":0,
       "candlemaking":0
     };
     var number_working = {
       "tailoring":0,
       "dataentry":0,
       "embroidery":0,
       "candlemaking":0
     };

      $.getJSON("members.json", function(json) {
        $.getJSON("report_activity.json",function(json){
          //number of trainings provided
          for(var i=0;i<json["activity"].length;i++) {
                 var row = json["activity"][i];
                 trainings[row["tag"]] ++;;
              }
         });
            //number of women trained & number of women working
            for(var i=0;i<json["members"].length;i++) {
                   var row = json["members"][i];
                   number_trained[row["update"]["skill"]] += row["update"]["vocational_training_done"];
                   if(row["update"]["salary"] != 0)
                   number_working[row["update"]["skill"]] += 1;
                }

            for (skill in trainings) {
                data.push({
                  'category': skill,
                  'number_type': "number_trained",
                  'value': number_trained[skill] + "",
                });
                data.push({
                  'category': skill,
                  'number_type': "number_working",
                  'value': number_working[skill] + "",
                });
                data.push({
                  'category': skill,
                  'number_type': "trainings",
                  'value': trainings[skill] + "",
                });
            }
      });
      console.log(data);
      // Create a new svg variable
      var svg = dimple.newSvg("#chart", "100%", "100%");
      // Create a new chart
      var myChart = new dimple.chart(svg, data);
      // Add an x-axis that groups the data by two categorical variables
      myChart.addCategoryAxis("x", ["category", "number_type"]);
      // Add a y-axis that is the percent of unit sales.
      myChart.addMeasureAxis("y", "value");
      // Add the data to the chart, grouped by "Channel"
      var avg = myChart.addSeries("number_type", dimple.plot.bar);
      // Calculate the average Unit Sales
      avg.aggregate = dimple.aggregateMethod.avg;
      console.log(avg.aggregate);
      // // Add some margins
       myChart.setMargins("10%", "10%", "10%", "20%");
      // // Add a legend 50% from the left, 5% from the top, 510 width and 20 height, with inside text aligned right
      myChart.addLegend("50%", "20%", 510, 20, "right");
      // Draw the chart
      myChart.draw();
  </script>
</body>
</html>
